---
import { marked } from "marked";

import { type Work } from "@/lib/types";
import DirectusImage from "@/components/ui/DirectusImage.astro";

interface Props {
  work: Work;
}

const { work } = Astro.props;

const taxonomyClasses = work.taxonomy
  ? work.taxonomy
      .map((t) => {
        if (typeof t === "object" && t.taxonomy_id) {
          if (typeof t.taxonomy_id === "object" && t.taxonomy_id.id) {
            return `taxonomy-${t.taxonomy_id.id}`;
          }
        }
      })
      .join(" ")
  : "";
---

<div class={`${taxonomyClasses}`}>
  <button>
    <figure style=`--width-scale: ${Math.random() * .5 + .75}`>
      {
        work.primary_view ? (
          <DirectusImage asset={work.primary_view} alt={work.title} />
        ) : (
          <div data-missing-image />
        )
      }
    </figure>
  </button>
  <article>
    <h2 set:html={marked.parseInline(work.title)} />
    {
      work.description ? (
        <div class="description" set:html={marked.parse(work.description)} />
      ) : null
    }
  </article>
</div>

<style>
  div {
    figure {
      --baseline-width: calc(var(--spacing--base) * 20);
      img {
        max-inline-size: calc(var(--width-scale, 1) * var(--baseline-width));
        height: auto;
      }

      div[data-missing-image] {
        width: var(--baseline-width);
        aspect-ratio: 4 / 3;
        border: 1px solid var(--color-grey);
      }
    }

    &.active {
      article {
        display: block;
      }
    }
    article {
      display: none;
      position: fixed;
      inset: 20%;
      background: black;
    }
  }
</style>
