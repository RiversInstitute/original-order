---
import Layout from "@/layouts/Layout.astro";
import Nav from "@/components/Nav.astro";
import ContentWrapper from "@/components/ContentWrapper.astro";
import TagNav from "@/components/TagNav.astro";

import { readItems } from "@directus/sdk";
import { Client } from "@/lib/directus";
import TagList from "@/components/TagList.astro";

const mediums = await Client.request(
  readItems("medium", {
    fields: ["id", "title"],
    limit: -1,
    sort: ["title"],
  }),
);

const works = await Client.request(
  readItems("works_medium", {
    fields: ["id", "medium_id"],
    limit: -1,
  }),
);

const count: Record<string, number> = {};
mediums.forEach(
  (tag) =>
    (count[tag.id] = works.filter((work) => work.medium_id === tag.id).length),
);
---

<Layout pageTitle="Mediums">
  <Nav />
  <ContentWrapper>
    <TagNav activeTag="medium" />
    <TagList tags={mediums} tagCount={count} urlBase="medium" />
  </ContentWrapper>
</Layout>
