---
import Layout from "@/layouts/Layout.astro";
import Nav from "@/components/Nav.astro";
import ContentWrapper from "@/components/ContentWrapper.astro";
import TagNav from "@/components/TagNav.astro";

import { readItems } from "@directus/sdk";
import { Client } from "@/lib/directus";
import TagList from "@/components/TagList.astro";

const series = await Client.request(
  readItems("series", {
    fields: ["id", "title"],
    limit: -1,
    sort: ["title"],
  }),
);

const works = await Client.request(
  readItems("works_series", {
    fields: ["id", "series_id"],
    limit: -1,
  }),
);

const count: Record<string, number> = {};
series.forEach(
  (tag) =>
    (count[tag.id] = works.filter((work) => work.series_id === tag.id).length),
);
---

<Layout pageTitle="Series">
  <Nav />
  <ContentWrapper>
    <TagNav activeTag="series" />
    <TagList tags={series} tagCount={count} urlBase="series" />
  </ContentWrapper>
</Layout>
